<div [class.page]="standAlonePage" [class.handset]="(isHandset$ | async)" [class.desktop]="!(isHandset$ | async)">

  <app-la-header *ngIf="standAlonePage"></app-la-header>

  <div class="fullWidth">

    <!-- TERMS HAVE NOT BEEN ACCEPTED YET -->
    <div *ngIf="licenceApplication.letterOfOffer.status === LetterOfOfferStatus['PENDING']" class="margin-top max-width-centered-content">

      <div class="margin-top bold">
        You must accept the Terms of the Letter of Offer
        for your <span class="bold">Sea Fishing Boat Licence Application</span> on or before {{ licenceApplication.letterOfOffer.expiryDate }}.<!--{{ utils.toDate(licenceApplication.letterOfOfferTermsDeadlineDate) | date }}-->
      </div>

      <div fxLayout="column" fxLayoutAlign="start center" class="form-field-icons"><!-- fxLayoutAlign="{{(isHandset$ | async) ? 'start center' : null}}" -->

        <div class="fullWidth margin-top">
          <div fxFill fxLayout="row" fxLayoutAlign="center start" fxLayoutGap="16px">
            <button mat-raised-button [class.fullWidth]="(isHandset$ | async)"(click)="showTerms = !showTerms">
              {{ showTerms ? 'HIDE TERMS' : 'VIEW TERMS' }}
              <mat-icon class="chevron_vert">{{!showTerms  ? 'keyboard_arrow_down' : 'keyboard_arrow_up' }}</mat-icon>
            </button>
            <button mat-raised-button [class.fullWidth]="(isHandset$ | async)">
              DOWNLOAD PDF
            </button>
          </div>
        </div>

        <div *ngIf="showTerms" [@fadeInOut]="'fadeIn'">
          <div class="centered-content margin-top-double wizard-label">TERMS</div>
          <div class="page letterOfOfferTerms mat-elevation-z8" >
            <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="16px" >
              <div *ngFor="let loaTerm of licenceApplication.letterOfOffer.terms" fxLayout="row" fxLayoutGap="16px">
                <div fxFlexAlign="start">{{loaTerm.id}})</div>
                <div fxFlexAlign="start" class="left">{{loaTerm.text}}</div>
              </div>
            </div>
          </div>
        </div>

        <mat-checkbox [(ngModel)]="termsAccepted" [ngModelOptions]="{standalone: true}" class="margin-top-double">
          <span>I accept the Terms of the Letter of Offer</span>
        </mat-checkbox>
      </div>

      <div class="margin-top">
        <mat-divider [inset]="false"></mat-divider>
      </div>
      <div class="fullWidth margin-top">
        <div fxFill fxLayout="row" fxLayoutAlign="center start" fxLayoutGap="16px">
          <button mat-raised-button [class.fullWidth]="(isHandset$ | async)"
                  (click)="back.emit(licenceApplication)">
            BACK
          </button>
          <button mat-raised-button [class.fullWidth]="(isHandset$ | async)" (click)="acceptLetterOfOffer()" [disabled]="!termsAccepted">
            SUBMIT
          </button>
          <button mat-raised-button [class.fullWidth]="(isHandset$ | async)" (click)="rejectLetterOfOffer()" [disabled]="termsAccepted">
            REJECT
          </button>
        </div>
      </div>

      <div *ngIf="errorMessage" [@fadeInOut]="'fadeIn'" class="errorBanner margin-vertical" fxLayoutAlign="start center">
        <mat-icon class="info-icon">error_outline</mat-icon>
        <div>{{ errorMessage }}</div>
      </div>

    </div> <!-- END TERMS NOT ACCEPTED YET -->

    <!-- TERMS HAVE BEEN ACCEPTED -->
    <div *ngIf="licenceApplication.letterOfOffer.status === LetterOfOfferStatus['ACCEPTED']" class="margin-top max-width-centered-content">

      <div class="margin-vertical">
          <span>
            <!-- TODO: if the acceptor is the logged in your, say 'You accepted the terms...' rather than 'John Murphy accepted the terms...' -->
            {{ licenceApplication.letterOfOffer.acceptedBy.firstName }} {{ licenceApplication.letterOfOffer.acceptedBy.lastName }}
            <span [class.br]="(isHandset$ | async)">accepted the Terms of the Letter of Offer </span>
            <span [class.br]="(isHandset$ | async)">for the <span class="bold">Sea Fishing Boat Licence Application</span></span>
            <span [class.br]="(isHandset$ | async)">on {{ licenceApplication.letterOfOffer.acceptedDate }}</span>
          </span>
      </div>

      <div class="margin-vertical bold">
        You must comply with the Terms of the Letter of Offer on or before {{ licenceApplication.expiryDate }}.<!--{{ utils.toDate(licenceApplication.letterOfOfferTermsDeadlineDate) | date }}-->
      </div>

      <div fxLayout="column" fxLayoutAlign="start center" class="form-field-icons"><!-- fxLayoutAlign="{{(isHandset$ | async) ? 'start center' : null}}" -->

        <div class="fullWidth margin-top">
          <div fxFill fxLayout="row" fxLayoutAlign="center start" fxLayoutGap="16px">
            <button mat-raised-button [class.fullWidth]="(isHandset$ | async)" (click)="showTerms = !showTerms">
              {{ showTerms ? 'HIDE TERMS' : 'VIEW TERMS' }}
              <mat-icon class="chevron_vert">{{!showTerms  ? 'keyboard_arrow_down' : 'keyboard_arrow_up' }}</mat-icon>
            </button>
            <button mat-raised-button [class.fullWidth]="(isHandset$ | async)">
              DOWNLOAD PDF
            </button>
          </div>
        </div>

        <div *ngIf="showTerms" [@fadeInOut]="'fadeIn'">
          <div class="centered-content margin-top-double wizard-label">TERMS</div>
          <div class="page letterOfOfferTerms mat-elevation-z8" >
            <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="16px" >
              <div *ngFor="let loaTerm of licenceApplication.letterOfOffer.terms" fxLayout="row" fxLayoutGap="16px">
                <div fxFlexAlign="start">{{loaTerm.id}})</div>
                <div fxFlexAlign="start" class="left">{{loaTerm.text}}</div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="enableDisplayOfPreliminaryInformation" class="fullWidth margin-vertical">
          <div fxFill fxLayout="row" fxLayoutAlign="center start">
            <button mat-raised-button [class.fullWidth]="(isHandset$ | async)" (click)="showPreliminaryInformation = !showPreliminaryInformation">
              {{ showPreliminaryInformation ? 'HIDE PRELIMINARY INFORMATION' : 'VIEW PRELIMINARY INFORMATION' }}
              <mat-icon class="chevron_vert">{{!showTerms  ? 'keyboard_arrow_down' : 'keyboard_arrow_up' }}</mat-icon>
            </button>
          </div>
        </div>
        <div *ngIf="showPreliminaryInformation" [@fadeInOut]="'fadeIn'">
          <div class="centered-content margin-top-double wizard-label">PRELIMINARY INFORMATION</div>
          <div class="page letterOfOfferTerms mat-elevation-z8" >
            <app-la-preliminary-info [readonly]="true" [embedded]="true" [licenceApplication]="licenceApplication"></app-la-preliminary-info>
          </div>
        </div>

      </div>

      <div class="margin-top">
        <mat-divider [inset]="false"></mat-divider>
      </div>
      <div class="fullWidth margin-top">
        <div fxFill fxLayout="row" fxLayoutAlign="center start" fxLayoutGap="16px">
          <button mat-raised-button [class.fullWidth]="(isHandset$ | async)"
                  (click)="back.emit(licenceApplication)" [disabled]="(isHandset$ | async) || licenceApplication.letterOfOffer.status === LetterOfOfferStatus['ACCEPTED']">
            BACK
          </button>
          <button mat-raised-button [class.fullWidth]="(isHandset$ | async)" (click)="next.emit(licenceApplication)">
            NEXT
          </button>
        </div>
      </div>

      <div *ngIf="errorMessage" [@fadeInOut]="'fadeIn'" class="errorBanner margin-vertical" fxLayoutAlign="start center">
        <mat-icon class="info-icon">error_outline</mat-icon>
        <div>{{ errorMessage }}</div>
      </div>

    </div> <!-- END TERMS HAVE BEEN ACCEPTED -->

  </div>

</div>
